#!/usr/bin/env bash
# conf - Quick access to Linux system config files

action=edit

edit() {
  if [[ "$1" == /etc/* ]] && [[ ! -w "$1" ]]; then
    sudo ${EDITOR:-vim} "$1"
  else
    ${EDITOR:-vim} "$1"
  fi
}

view() {
  if [[ "$1" == /etc/* ]] && [[ ! -r "$1" ]]; then
    sudo cat "$1"
  else
    cat "$1"
  fi
}

if [[ "$1" == "cat" ]]; then
  action=view
  shift
fi

case "$1" in
  # shell configs
  bashrc)       $action "$BASHRC/bashrc" ;;
  alias|aliases) $action "$BASHRC/modules/universal/aliases.sh" ;;
  path|paths)   $action "$BASHRC/modules/universal/paths.sh" ;;
  local)        $action "$BASHRC/modules/local.sh" ;;
  defaults)     $action "$BASHRC/modules/defaults/defaults.sh" ;;
  # system configs
  ssh)          $action ~/.ssh/config ;;
  hosts)        $action /etc/hosts ;;
  fstab)        $action /etc/fstab ;;
  environment)  $action /etc/environment ;;
  hostname)     $action /etc/hostname ;;
  resolv)       $action /etc/resolv.conf ;;
  grub)         $action /etc/default/grub ;;
  sources)      $action /etc/apt/sources.list ;;
  profile)      $action /etc/profile ;;
  xdg)          $action ~/.config/user-dirs.dirs ;;
  nix|nixos)
    nixdir="/etc/nixos"
    case "$2" in
      ""|config)      $action "$nixdir/configuration.nix" ;;
      pkg|packages)   $action "$nixdir/packages.nix" ;;
      net|network)    $action "$nixdir/network.nix" ;;
      users)          $action "$nixdir/users.nix" ;;
      services|svc)   $action "$nixdir/services.nix" ;;
      *)              $action "$nixdir/$2.nix" ;;
    esac
    ;;
  ""|--help|-h)
    echo "Usage: conf [cat] <config>"
    echo ""
    echo "  conf aliases      Edit aliases"
    echo "  conf cat aliases  View aliases"
    echo ""
    echo "Shell:"
    echo "  bashrc       $BASHRC/bashrc"
    echo "  aliases      $BASHRC/modules/universal/aliases.sh"
    echo "  paths        $BASHRC/modules/universal/paths.sh"
    echo "  local        $BASHRC/modules/local.sh"
    echo "  defaults     $BASHRC/modules/defaults/defaults.sh"
    echo ""
    echo "System:"
    echo "  ssh          ~/.ssh/config"
    echo "  hosts        /etc/hosts"
    echo "  fstab        /etc/fstab"
    echo "  environment  /etc/environment"
    echo "  hostname     /etc/hostname"
    echo "  resolv       /etc/resolv.conf"
    echo "  grub         /etc/default/grub"
    echo "  sources      /etc/apt/sources.list"
    echo "  profile      /etc/profile"
    echo "  xdg          ~/.config/user-dirs.dirs"
    echo ""
    echo "NixOS (/etc/nixos/):"
    echo "  nix [config]     configuration.nix"
    echo "  nix pkg          packages.nix"
    echo "  nix network      network.nix"
    echo "  nix users        users.nix"
    echo "  nix services     services.nix"
    echo "  nix <name>       <name>.nix"
    ;;
  *)
    echo "Unknown config: $1"
    echo "Run 'conf --help' for available configs"
    exit 1
    ;;
esac
